# Portfolio (final version)

My online business card and portfolio of my featured development projects. Live at [helenmckay.dev](https://helenmckay.dev). 

## How it's made

React application with Firebase back-end. 

Browser Router and custom protected routes used for routing. Page components are lazy loaded using React.lazy() and Suspense. State is managed with Hooks, including `react-firebase-hooks`.

Firebase used for user authentication, image storage (Firebase Storage), database (Firebase Firestore), and hosting. 

## Cool features

Logging in as an authenticated user grants me access to the Admin page. There, I can view, update, or delete the portfolio cards, as well as create new cards. These cards are stored in Firestore. Images associated with portfolio cards are stored in Firebase Storage.

In other words, this application is fully CRUD. I can manage everything in the application's Firebase Firestore and Storage purely from the application front-end without ever logging in to the Firebase console.

## Featured snippets

The bulk of the application logic can be found in **AdminCard.js**. 

Here's some featured snippets from **AdminCard.js**:

### Checking if the card has an image associated with it in Storage

`doc_id` is the key auto-generated by Firestore when a new card is created. A card's `doc_id` is used to name the image uploaded to the card. Images are stored at route `projects/[doc_id]/[doc_id].jpg` in Firebase Storage. Firebase Storage does not have folder objects. However, you can use the `.listAll()` function on a route to list all the files at that route as if it was a directory. I use this to check if a card has an associated image. Checking for existence is crucial to preventing Storage functions errors (Storage functions assume existence).

```
const AdminCard = ({doc_id, data, updateCard, deleteCard}) => {
    const [hasImage, setHasImage] = useState(false);

    useEffect(() => {
        async function checkForImage(){
            const result = await firebase.storage().ref(`projects/${doc_id}`).listAll();

            if (result.items.length > 0)
            {
                setHasImage(true);
            }
        };

        checkForImage();
    }, [doc_id])
    
    ...
```

### If an AdminCard has an associated image, then display that image

**AdminCard** renders **AdminCardImageFetcher** component, passing along `doc_id`.

```
 {hasImage && <AdminCardImageFetcher doc_id={doc_id}/>}
```

AdminCardImageFetcher component uses the `useDownloadURL` Hook from `react-firebase-hooks` to get the download URL of the image from Storage. Errors are prevented because the image's existence has already been verified and thus `useDownloadURL` always receives a valid Storage path.

```
const AdminCardImageFetcher = (props) => {
    const [downloadURL, URL_loading, ,] = useDownloadURL(
        firebase.storage().ref(`projects/${props.doc_id}/${props.doc_id}.jpg`)
    );

    return(
        <div className="pic_container">
            {URL_loading ?
            <p>Loading image...</p>
            :<img src={downloadURL} alt=""/>}
        </div>
    )
}
```
### Submitting changes to an AdminCard

If there is a new image for the AdminCard, then remove the current image (if there is one). Then, store the new image at `projects/[doc_id]/[doc_id].jpg` in Storage. Then, send the `doc_id` and state values to the function `updateCard()` (in **Admin.js**, passed down as a prop to **AdminCard** component).

In **AdminCard.js**:

```
const handleSubmit = (e) => {
        e.preventDefault();

        //there is a new image to be uploaded
        if (newImage)
        {
            //there is already an image for this post
            if (hasImage)
            {
                //delete it and replace it

                firebase.storage().ref(`projects/${doc_id}/${doc_id}.jpg`).delete().catch(error => {
                    console.log(error);
                }).then(
                    firebase.storage().ref(`projects/${doc_id}/${doc_id}.jpg`).put(newImage, metaData).then(() => {
                        setNewImage(null);
                    })
                )
            }
            else
            {
                //there is not already an image for this post
                //so, put the image there

                firebase.storage().ref(`projects/${doc_id}/${doc_id}.jpg`).put(newImage, metaData).catch(error => {
                    console.log("something went wrong");
                }).then(() => {
                    setNewImage(null);
                });
            }
        }

        updateCard(doc_id, {
            title: title,
            tech: tech,
            github: github,
            codepen: codepen,
            live: live,
            description: description,
            date: data.date,
            publicToggle: publicToggle
        });
    }
```
In **Admin.js**:

```
const updateCard = (id, newValues) => {
        firebase.firestore().collection('projects').doc(id).update(newValues);
    }
```

